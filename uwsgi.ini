[uwsgi]
plugin          = python,transformation_gzip
chdir           = /misago/
module          = misagodocker.wsgi
master          = true
processes       = 4
http-socket     = 0.0.0.0:80
buffer-size     = 4096

# Serve static files through uwsgi
static-map      = /media=/misago/media
static-map      = /static=/misago/static
offload-threads = %k

# Use gzip compression
cache = 1024
; if the client support gzip encoding goto to the gzipper
route-if = contains:${HTTP_ACCEPT_ENCODING};gzip goto:mygzipper
route = ^/ cache:key=misago
route = ^/ cachestore:key=misago
route-run = last:

route-label = mygzipper
route = ^/ cache:key=misago.gz
route = ^/ cachestore:key=misago
route = ^/ gzip:
route = ^/ cachestore:key=misago.gz

# Create a cache storing staticfiles paths. This reduces the number of stat() calls
cache2                  = name=paths,items=1024
static-cache-paths      = 3600
static-cache-paths-name = paths

# Send long-expire cache header for staticfiles
static-expires      = /* 31536000

# Logging
log-x-forwarded-for
logger              = file:/misago/logs/uwsgi.log